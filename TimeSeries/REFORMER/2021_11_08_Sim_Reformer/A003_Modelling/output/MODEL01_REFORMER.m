function [Y,Xf,Af] = MODEL01_REFORMER(X,~,~)
%MODEL01_REFORMER neural network simulation function.
%
% Auto-generated by MATLAB, 30-Jan-2021 07:15:28.
% 
% [Y] = MODEL01_REFORMER(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 3xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-1.7208886344043;-1.74612024559196;-1.7064501139682];
x1_step1.gain = [0.577709408700036;0.580826887171323;0.591349137094081];
x1_step1.ymin = -1;

% Layer 1
b1 = [3.9572488211306700023;-0.095530998061420402401;-1.2024350740654261571;0.4364044647082025441;0.23613508555705139957;1.0834974317586214543;-1.2763433379112500976;-0.60608984257928832928;-5.0378122042720985263;3.0615006944234948172];
IW1_1 = [-3.5682399158812141415 0.75370551972732102719 -1.6402519528253858283;0.38479611039435385189 0.26407906745787884661 0.11640803269678136334;-1.639170738234733804 -0.77390649511967157803 0.070886761502087169973;0.069759193472323011154 0.058160474855897634217 1.2605405347669704774;1.3217800382277355986 0.67230659025801786655 -0.56975029035909086073;2.3672613457106046475 1.0768033509286079052 2.6351613898701797822;-0.96298140580145275003 -0.37959517518257768209 0.0077651801930671577462;-0.43362930760362389249 0.022293779261469671982 -0.043738561933563499529;-1.9264676957363870979 2.1230292095624871962 -0.46221538023456115729;0.85104076529456051947 -0.72372765541309691528 -0.048362847538462018504];

% Layer 2
b2 = [-1.1372193045001390832;-1.2697297660121902307;1.0731841014081981989;-0.8707886994703143424;-0.66703096977343157015;-0.62112732608329657147;-0.63576336835492675004;0.052114996017924707095;0.25335410899321259004;-0.71558902561024395617];
LW2_1 = [-0.056103090793707482975 -0.41626589875640668259 -0.12407972747689666182 0.74905340548964527425 -0.16969262861808001586 -0.043264971960767360792 -1.6269808592398702363 0.72590591563315054469 -0.098996572444082497899 -0.19232611582810682505;-1.5518991935057497855 -0.26005337707917264289 -0.76609047078383218921 0.87168892184472679396 0.77713278951753461676 -2.0012573048043296176 1.472950202496833727 -0.62847761740940677466 1.9961040005972134903 -1.0657556722575567409;-0.020177844424740340457 0.48203416022453271506 -0.28083703329601578114 1.4946319012444220231 -0.39237109634506300848 -0.037221799691955534395 -0.83714415442675982337 1.4801558695648071584 0.0084281026786456759298 1.1385520100237984664;0.064430069236251261144 -0.5736541173206869404 0.5566339774736335233 -0.65302177853494680626 0.07760626864123745805 -0.031075788980669847433 -0.23990662352507322042 -0.62181686001475755532 0.53665272350381443278 1.6149428330828703437;0.010509272563860649202 -1.3274071702784699944 2.3133554370241240505 -0.86142323664332387523 -0.040785137724756455324 0.20696700903177531194 -4.2837413043408671953 1.8535066923116652049 -0.53207297665407304876 -1.0145059903500048826;-0.0213774115245075301 -0.77224121235767151372 1.2244480313890446777 -0.88510665495287410565 -0.15323402296055937954 -0.095981327713586722661 -1.2286707724430152577 0.89186820152674328721 0.18981872705116120681 1.0057685526644672969;-1.6017209794292135427 0.41947460084498405797 -4.2277954244667510508 0.097311709681783348236 -1.4604551324108216992 1.5123245992078644395 -4.290727582476666413 -0.55983511770517047079 2.5524519128640688059 -1.0914607699618736891;-0.061864643454107623444 2.0817681096680513697 1.4370810095606263435 -0.00080484198606640966478 -0.56527502622244063524 -1.111853159810063163 -0.54717434762953731653 -0.30817368227833646932 -0.020408750318291653258 1.5851705474365120896;-0.14712464966596217053 -1.2607400793125351779 0.55479718857282245281 0.86063968022237935518 0.17843307414125783583 -0.39517764564198687438 -0.88807499741427253781 1.5275920221686141165 0.13939423669924944083 -0.93903362822487779216;-0.025792862120154261274 -0.6701195813419428271 0.048602492964670049314 0.07517506686555289197 -0.047149869683123880881 -0.016881701928034165833 1.00258010806242015 -2.2928946960514973163 -0.54215495560661941532 -1.5074686542197612837];

% Layer 3
b3 = [-0.50184257021593048353;0.4868525019813110255];
LW3_2 = [1.9062484307066120959 -0.27371638325973318695 -0.19403459827704494511 2.0691024985698498462 1.3660838502337606659 -2.5731988828589167362 -0.20448282904972023277 0.5391256947723966908 0.63910868578587609612 0.20324898730560103655;1.2610478839709728938 -0.91806065896022892581 1.4328174878496626743 1.6490412791403610271 0.30757882240284672992 -0.78745475306402923366 -0.031892631732068306427 0.065827920360408950784 -0.060728857640509462112 3.9957450560648615223];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [0.439949156945085;0.382838728796948];
y1_step1.xoffset = [-1.6950468857749;-2.30356380071742];

% ===== SIMULATION ========

% Format Input Arguments

Xcell = {X};
% Dimensions
TS = size(Xcell,2); % timesteps
if ~isempty(Xcell)
  Q = size(Xcell{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,1);

% Time loop

% Input 1
Xp1 = mapminmax_apply(Xcell{1,1},x1_step1);

% Layer 1
a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);

% Layer 2
a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);

% Layer 3
a3 = repmat(b3,1,Q) + LW3_2*a2;

% Output 1
Y{1,1} = mapminmax_reverse(a3,y1_step1);

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
Y = Y{:};
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
